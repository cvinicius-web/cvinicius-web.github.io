<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Atividade 06 - Gestão de Gastos Simples</title>
    <style>
        /* CSS Simplificado */
        body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; background-color: #f0f0f0; }
        .secao { background-color: white; padding: 15px; border-radius: 5px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #32CD32; padding-bottom: 5px; margin-bottom: 10px; }
        input, select { margin: 5px 0; padding: 8px; border: 1px solid #ccc; width: 95%; box-sizing: border-box; }
        button { padding: 8px 15px; margin-top: 10px; cursor: pointer; border: none; border-radius: 4px; }
        #adicionar { background-color: #32CD32; color: white; }
        #calcular { background-color: #1E90FF; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #resumo-div { border-left: 5px solid #1E90FF; padding-left: 10px; }
    </style>
</head>
<body>

<div class="secao">
    <h2>Entrada de Gastos</h2>

    <div>
        <label for="categoria">Categoria:</label>
        <select id="categoria">
            <option value="Mercado">Mercado</option>
            <option value="Transporte">Transporte</option>
            <option value="Lazer">Lazer</option>
            <option value="Outros">Outros</option>
        </select>
    </div>

    <div>
        <label for="valor">Valor:</label>
        <input type="number" id="valor" min="0.01" step="0.01" required>
    </div>
    <div>
        <label for="data">Data:</label>
        <input type="date" id="data" required>
    </div>
    
    <button id="adicionar">Adicionar</button>
    <button id="calcular">Calcular</button>

    <h3>Extrato Bancário</h3>
    <table id="extrato-tabela">
        <thead>
            <tr><th>Categoria</th><th>Data</th><th>Valor</th></tr>
        </thead>
        <tbody id="extrato-body">
        </tbody>
    </table>
</div>

<div class="secao" id="resumo-div">
    <h2>Resumo</h2>
    <div id="resumo-conteudo">
        <p>Clique em "Calcular" para ver o resumo.</p>
    </div>
</div>

<script>
    const categoriaInput = document.getElementById('categoria');
    const valorInput = document.getElementById('valor');
    const dataInput = document.getElementById('data');
    const extratoBody = document.getElementById('extrato-body');
    const resumoConteudo = document.getElementById('resumo-conteudo');
    const extrato = [];

    // Função auxiliar para formatação de moeda
    const formatarMoeda = (valor) => 'R$ ' + valor.toFixed(2).replace('.', ',');

    // --- ADICIONAR ITEM ---
    document.getElementById('adicionar').addEventListener('click', function() {
        const categoria = categoriaInput.value;
        const valor = parseFloat(valorInput.value);
        const data = dataInput.value;

        if (!categoria || isNaN(valor) || valor <= 0 || !data) {
            alert("Preencha todos os campos corretamente.");
            return;
        }

        // 1. Armazena o gasto
        extrato.push({ categoria, valor, data });

        // 2. Adiciona a linha na tabela (Formatação de data simples)
        const newRow = extratoBody.insertRow();
        const dataFormatada = data.split('-').reverse().join('/'); // YYYY-MM-DD -> DD/MM/YYYY
        
        newRow.insertCell(0).textContent = categoria;
        newRow.insertCell(1).textContent = dataFormatada;
        newRow.insertCell(2).textContent = formatarMoeda(valor);

        // 3. Limpa e reseta
        valorInput.value = '';
        resumoConteudo.innerHTML = '<p>Clique em "Calcular" para ver o resumo.</p>';
    });

    // --- CALCULAR RESUMO ---
    document.getElementById('calcular').addEventListener('click', function() {
        if (extrato.length === 0) {
            resumoConteudo.innerHTML = '<h3>Nenhum gasto para analisar.</h3>';
            return;
        }

        let totalGeral = 0;
        let totalPorMes = {};
        let totalPorCategoria = {};

        extrato.forEach(item => {
            // Consolida todos os totais em um único loop
            totalGeral += item.valor;
            
            const mes = item.data.substring(5, 7);
            const cat = item.categoria;

            totalPorMes[mes] = (totalPorMes[mes] || 0) + item.valor;
            totalPorCategoria[cat] = (totalPorCategoria[cat] || 0) + item.valor;
        });

        // --- Montagem do HTML de Resumo ---
        let html = '<h3>Resumo</h3>';
        html += `<p>Total Geral: <strong>${formatarMoeda(totalGeral)}</strong></p>`;

        // Totais por Mês
        Object.keys(totalPorMes).sort().forEach(mes => {
            html += `<p>Total no Mês ${mes}: ${formatarMoeda(totalPorMes[mes])}</p>`;
        });

        // Totais por Categoria
        Object.keys(totalPorCategoria).sort().forEach(cat => {
            html += `<p>Total de gastos com ${cat}: <strong>${formatarMoeda(totalPorCategoria[cat])}</strong></p>`;
        });
        
        resumoConteudo.innerHTML = html;
    });
</script>
</body>
</html>
